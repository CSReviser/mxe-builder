MessageWindow::MessageWindow(QWidget *parent)
    : QWidget(parent, Qt::CustomizeWindowHint|Qt::WindowTitleHint|Qt::WindowCloseButtonHint)
{
    setupGui();

    // Settings から geometry を読み込む
    const QByteArray &geo = Settings::instance().messageWindowGeometry;
    if (!geo.isEmpty()) {
        restoreGeometry(geo);
    } else {
        resize(DEFAULT_WIDTH, DEFAULT_HEIGHT);
    }
}

MessageWindow::~MessageWindow()
{
    if (MainWindow::no_write_ini == "yes") {
        Settings::instance().saveMessageWindow(saveGeometry());
    }
}



[ 52%] Building CXX object CMakeFiles/CaptureStream2.dir/messagewindow.cpp.obj
/home/kazuo/cs/CaptureStream2/messagewindow.cpp: In constructor 'MessageWindow::MessageWindow(QWidget*)':
/home/kazuo/cs/CaptureStream2/messagewindow.cpp:59:49: error: base operand of '->' has non-pointer type 'Settings'
   59 |     const QByteArray &geo = Settings::instance()->messageWindowGeometry;
      |                                                 ^~
/home/kazuo/cs/CaptureStream2/messagewindow.cpp: In destructor 'virtual MessageWindow::~MessageWindow()':
/home/kazuo/cs/CaptureStream2/messagewindow.cpp:71:29: error: base operand of '->' has non-pointer type 'Settings'
   71 |         Settings::instance()->saveMessageWindow(saveGeometry());
      |                             ^~
make[2]: *** [CMakeFiles/CaptureStream2.dir/build.make:188: CMakeFiles/CaptureStream2.dir/messagewindow.cpp.obj] エラー 1
make[1]: *** [CMakeFiles/Makefile2:86: CMakeFiles/CaptureStream2.dir/all] エラー 2
make: *** [Makefile:91: all] エラー 2





#include "messagewindow.h"
#include "ui_messagewindow.h"
#include "mainwindow.h"
#include "utility.h"
#include "qt4qt5.h"
#include "settings.h"   // ★ 追加

#include <QtGui>
#include <QTextCursor>
#include <QWidget>

namespace {
    const int DEFAULT_WIDTH = 540;
    const int DEFAULT_HEIGHT = 300;
#ifdef Q_OS_WIN
    const int FONT_SIZE = 13;
#else
#ifdef Q_OS_MACOS
    const int FONT_SIZE = 11;
#else
    const int FONT_SIZE = 14;
#endif
#endif
}

MessageWindow::MessageWindow(QWidget *parent)
    : QWidget(parent, Qt::CustomizeWindowHint|Qt::WindowTitleHint|Qt::WindowCloseButtonHint)
{
    setupGui();

    // ★ Settings.cpp から geometry を読み込む
    const QByteArray &geo = Settings::instance()->messageWindowGeometry;
    if (!geo.isEmpty()) {
        restoreGeometry(geo);
    } else {
        resize(DEFAULT_WIDTH, DEFAULT_HEIGHT);
    }
}

MessageWindow::~MessageWindow()
{
    if (MainWindow::no_write_ini == "yes") {
        // ★ geometry を保存
        Settings::instance()->saveMessageWindow(saveGeometry());
    }
}




settings.cpp
void Settings::loadMessageWindow()
{
    QSettings ini(Constants::IniFileName, QSettings::IniFormat);
    ini.beginGroup(Constants::SETTING_GROUP_MessageWindow);
    messageWindowGeometry = ini.value("geometry").toByteArray();
    ini.endGroup();
}

void Settings::saveMessageWindow(const QByteArray &geometry)
{
    messageWindowGeometry = geometry;
    QSettings ini(Constants::IniFileName, QSettings::IniFormat);
    ini.beginGroup(Constants::SETTING_GROUP_MessageWindow);
    ini.setValue("geometry", geometry);
    ini.endGroup();
}

messagewindow.cpp
#include "messagewindow.h"
#include "ui_messagewindow.h"
#include "mainwindow.h"
#include "utility.h"
#include "qt4qt5.h"

#include <QtGui>
#include <QTextCursor>
#include <QSettings>
#include <QVariant>
#include <QWidget>

namespace {
	const QString SETTING_GROUP( "MessageWindow" );
	const QString SETTING_GEOMETRY( "geometry" );
	const int DEFAULT_WIDTH = 540;
	const int DEFAULT_HEIGHT = 300;
#ifdef Q_OS_WIN
	const int FONT_SIZE = 13;
#else
#ifdef Q_OS_MACOS
	const int FONT_SIZE = 11;
#else
	const int FONT_SIZE = 14;
#endif
#endif
}

MessageWindow::MessageWindow(QWidget *parent) :
		QWidget(parent, Qt::CustomizeWindowHint|Qt::WindowTitleHint|Qt::WindowCloseButtonHint) {
	setupGui();
	settings( false );
}

MessageWindow::~MessageWindow() {
	if ( MainWindow::no_write_ini == "yes" )
	settings( true );
}

void MessageWindow::changeEvent( QEvent *e ) {
    QWidget::changeEvent(e);
    switch (e->type()) {
    case QEvent::LanguageChange:
        break;
    default:
        break;
    }
}

void MessageWindow::setupGui() {
	textEdit = new QPlainTextEdit;
	textEdit->setReadOnly( true );
	textEdit->setWordWrapMode( QTextOption::WrapAnywhere );
	QFont* font = new QFont();
	font->setPixelSize( FONT_SIZE );
	textEdit->setFont( *font );

	clearTextButton = new QPushButton( QString::fromUtf8( "クリア" ) );
	connect( clearTextButton, SIGNAL(clicked()), this, SLOT(clearText()) );

	QVBoxLayout *mainLayout = new QVBoxLayout;
	mainLayout->addWidget(textEdit);
	mainLayout->addWidget(clearTextButton);

	setLayout(mainLayout);
}

QString MessageWindow::text() {
	return textEdit->toPlainText();
}

// 改行あり
void MessageWindow::appendParagraph( const QString& text ) {
	if ( !Utility::nogui() ) {
		show();
		textEdit->appendPlainText( text );
	}
}

// 改行なし
void MessageWindow::append( const QString& text ) {
	if ( !Utility::nogui() ) {
		show();
		QTextCursor cursor = textEdit->textCursor();
		cursor.movePosition( QTextCursor::End );
		textEdit->setTextCursor( cursor );
		textEdit->insertPlainText( text );
	}
}

void MessageWindow::clearText() {
	textEdit->clear();
}

void MessageWindow::settings( bool write ) {
	QSettings settings( MainWindow::ini_file_path + INI_FILE, QSettings::IniFormat );
	settings.beginGroup( SETTING_GROUP );

	if ( !write ) {
		QVariant saved = settings.value( SETTING_GEOMETRY );
		if ( saved.isValid() ) 
					restoreGeometry( saved.toByteArray() );
		else
			resize( DEFAULT_WIDTH, DEFAULT_HEIGHT );
		
	} else {
		settings.setValue( SETTING_GEOMETRY, saveGeometry() );
	}

	settings.endGroup();
}





#ifndef SETTINGS_H
#define SETTINGS_H

#include <QString>
#include <QMap>
#include <QVector>

#include "constants.h"

class Settings {
public:
    Settings();
    static Settings& instance();

    void load();
    void save();

    void loadMainWindow();
    void saveMainWindow(const QByteArray &geometry);

    void loadMessageWindow();
    void saveMessageWindow(const QByteArray &geometry);

    // ===== CustomizeDialog: TITLE / FILENAME =====
    static QString getTitleFormat(int index);
    static QString getFileNameFormat(int index);

    void setTitleFormatValue(int index, const QString &value);
    void setFileNameFormatValue(int index, const QString &value);

    // ===== CheckBox flags =====
    static bool tagSpaceFlag();
    static bool nameSpaceFlag();

    static void setTagSpaceFlag(bool flag);
    static void setNameSpaceFlag(bool flag);

    // ===== Program lists =====
    QStringList allProgramIds() const;
    QVector<bool> allProgramFlags() const;
    QStringList allProgramTitles() const;

    // ===== Public members =====
    QMap<QString, bool> englishEnabled;
    QMap<QString, bool> optionalEnabled;
    QMap<QString, QString> optionalId;
    QMap<QString, QString> optionalTitle;

    QMap<QString, bool> specEnabled;
    QMap<QString, QString> specId;
    QMap<QString, QString> specTitle;

    QMap<QString, bool> checkBoxEnabled;

    QString audioExtension;
    QString saveFolder;
    QString ffmpegFolder;

    QByteArray mainWindowGeometry;
    QByteArray messageWindowGeometry;

    QString optionals[Constants::OPT_PRESET_SIZE];
    QString specials[Constants::PRESET_SIZE];

private:
    // CustomizeDialog formats
    QString titleFormat[Constants::ITEM_COUNT];
    QString fileNameFormat[Constants::ITEM_COUNT];
};

#endif // SETTINGS_H


#include "settings.h"
#include <QSettings>

Settings::Settings()
{
}

Settings& Settings::instance()
{
    static Settings inst;
    return inst;
}

void Settings::load()
{
    QSettings ini(Constants::IniFileName, QSettings::IniFormat);

    ini.beginGroup(Constants::SETTING_GROUP_MainWindow);

    // ===== English =====
    for (int i = 0; i < Constants::EnglishCount; i++) {
        const auto &p = Constants::EnglishPrograms[i];
        englishEnabled[p.key] =
            ini.value(p.key, p.enabled).toBool();
    }

    // ===== Optional =====
    for (int i = 0; i < Constants::OptionalCount; i++) {
        const auto &p = Constants::OptionalPrograms[i];

        optionalEnabled[p.keyEnabled] =
            ini.value(p.keyEnabled, p.enabledDefault).toBool();

        optionalId[p.keyId] =
            ini.value(p.keyId, p.idDefault).toString();

        optionalTitle[p.keyTitle] =
            ini.value(p.keyTitle, p.titleDefault).toString();
    }

    // ===== Spec =====
    for (int i = 0; i < Constants::SpecialCount; i++) {
        const auto &p = Constants::SpecPrograms[i];

        specEnabled[p.keyEnabled] =
            ini.value(p.keyEnabled, p.enabledDefault).toBool();

        specId[p.keyId] =
            ini.value(p.keyId, p.idDefault).toString();

        specTitle[p.keyTitle] =
            ini.value(p.keyTitle, p.titleDefault).toString();
    }

    // ===== CheckBox =====
    for (int i = 0; i < Constants::CheckBoxCount; i++) {
        const auto &c = Constants::CheckBoxSettings[i];
        checkBoxEnabled[c.keyEnabled] =
            ini.value(c.keyEnabled, c.enabledDefault).toBool();
    }

    // ===== Other settings =====
    audioExtension = ini.value(Constants::KEY_AudioExtension,
                               Constants::DEFAULT_AudioExtension).toString();

    {
        QVariant v = ini.value(Constants::KEY_SaveFolder);
        saveFolder = v.isValid() ? v.toString() : QString();
    }

    {
        QVariant v = ini.value(Constants::KEY_FfmpegFolder);
        ffmpegFolder = v.isValid() ? v.toString() : QString();
    }

    mainWindowGeometry = ini.value("geometry").toByteArray();

    ini.endGroup();

    // ===== MessageWindow =====
    ini.beginGroup(Constants::SETTING_GROUP_MessageWindow);
    messageWindowGeometry = ini.value("geometry").toByteArray();
    ini.endGroup();

    // ===== ScrambleDialog =====
    ini.beginGroup(Constants::SETTING_GROUP_ScrambleDialog);
    for (int i = 0; i < Constants::OPT_PRESET_SIZE; ++i) {
        optionals[i] = ini.value(QString("optional%1").arg(i + 1), "").toString();
    }
    ini.endGroup();

    // ===== Settingsdialog =====
    ini.beginGroup(Constants::SETTING_GROUP_Settingsdialog);
    for (int i = 0; i < Constants::PRESET_SIZE; ++i) {
        specials[i] = ini.value(QString("special%1").arg(i + 1), "").toString();
    }
    ini.endGroup();

    // ===== CustomizeDialog: TITLE / FILENAME =====
    ini.beginGroup(Constants::SETTING_GROUP_CustomizeDialog);

    for (int i = 0; i < Constants::ITEM_COUNT; ++i) {
        const auto &t = Constants::TITLE_ITEMS[i];
        titleFormat[i] = ini.value(t.key, t.defaultValue).toString();

        const auto &f = Constants::FILENAME_ITEMS[i];
        fileNameFormat[i] = ini.value(f.key, f.defaultValue).toString();
    }

    ini.endGroup();
}

void Settings::save()
{
    QSettings ini(Constants::IniFileName, QSettings::IniFormat);

    ini.beginGroup(Constants::SETTING_GROUP_MainWindow);

    // ===== English =====
    for (int i = 0; i < Constants::EnglishCount; i++) {
        const auto &p = Constants::EnglishPrograms[i];
        ini.setValue(p.key, englishEnabled[p.key]);
    }

    // ===== Optional =====
    for (int i = 0; i < Constants::OptionalCount; i++) {
        const auto &p = Constants::OptionalPrograms[i];

        ini.setValue(p.keyEnabled, optionalEnabled[p.keyEnabled]);
        ini.setValue(p.keyId,      optionalId[p.keyId]);
        ini.setValue(p.keyTitle,   optionalTitle[p.keyTitle]);
    }

    // ===== Spec =====
    for (int i = 0; i < Constants::SpecialCount; i++) {
        const auto &p = Constants::SpecPrograms[i];

        ini.setValue(p.keyEnabled, specEnabled[p.keyEnabled]);
        ini.setValue(p.keyId,      specId[p.keyId]);
        ini.setValue(p.keyTitle,   specTitle[p.keyTitle]);
    }

    // ===== CheckBox =====
    for (int i = 0; i < Constants::CheckBoxCount; i++) {
        const auto &c = Constants::CheckBoxSettings[i];
        ini.setValue(c.keyEnabled, checkBoxEnabled[c.keyEnabled]);
    }

    // ===== Other settings =====
    ini.setValue(Constants::KEY_AudioExtension, audioExtension);

    if (saveFolder.isNull())
        ini.remove(Constants::KEY_SaveFolder);
    else
        ini.setValue(Constants::KEY_SaveFolder, saveFolder);

    if (ffmpegFolder.isNull())
        ini.remove(Constants::KEY_FfmpegFolder);
    else
        ini.setValue(Constants::KEY_FfmpegFolder, ffmpegFolder);

    ini.setValue("geometry", mainWindowGeometry);

    ini.endGroup();

    // ===== MessageWindow =====
    ini.beginGroup(Constants::SETTING_GROUP_MessageWindow);
    ini.setValue("geometry", messageWindowGeometry);
    ini.endGroup();

    // ===== ScrambleDialog =====
    ini.beginGroup(Constants::SETTING_GROUP_ScrambleDialog);
    for (int i = 0; i < Constants::OPT_PRESET_SIZE; ++i) {
        ini.setValue(QString("optional%1").arg(i + 1), optionals[i]);
    }
    ini.endGroup();

    // ===== Settingsdialog =====
    ini.beginGroup(Constants::SETTING_GROUP_Settingsdialog);
    for (int i = 0; i < Constants::PRESET_SIZE; ++i) {
        ini.setValue(QString("special%1").arg(i + 1), specials[i]);
    }
    ini.endGroup();

    // ===== CustomizeDialog: TITLE / FILENAME =====
    ini.beginGroup(Constants::SETTING_GROUP_CustomizeDialog);

    for (int i = 0; i < Constants::ITEM_COUNT; ++i) {
        const auto &t = Constants::TITLE_ITEMS[i];
        ini.setValue(t.key, titleFormat[i]);

        const auto &f = Constants::FILENAME_ITEMS[i];
        ini.setValue(f.key, fileNameFormat[i]);
    }

    ini.endGroup();
}

/* ============================================================
 *  CustomizeDialog API
 * ============================================================ */
QString Settings::getTitleFormat(int index)
{
    return instance().titleFormat[index];
}

QString Settings::getFileNameFormat(int index)
{
    return instance().fileNameFormat[index];
}

void Settings::setTitleFormatValue(int index, const QString &value)
{
    instance().titleFormat[index] = value;
}

void Settings::setFileNameFormatValue(int index, const QString &value)
{
    instance().fileNameFormat[index] = value;
}

/* ============================================================
 *  CheckBox flags
 * ============================================================ */
bool Settings::tagSpaceFlag()
{
    return instance().checkBoxEnabled[Constants::KEY_TAG_SPACE];
}

bool Settings::nameSpaceFlag()
{
    return instance().checkBoxEnabled[Constants::KEY_NAME_SPACE];
}

void Settings::setTagSpaceFlag(bool flag)
{
    instance().checkBoxEnabled[Constants::KEY_TAG_SPACE] = flag;
}

void Settings::setNameSpaceFlag(bool flag)
{
    instance().checkBoxEnabled[Constants::KEY_NAME_SPACE] = flag;
}





nameSpaceFlag() settings.checkBoxEnabled[Constants::KEY_NAME_SPACE]
tagSpaceFlag()  settings.checkBoxEnabled[Constants::KEY_TAG_SPACE]


[ 78%] Linking CXX executable CaptureStream2.exe
/opt/mxe/usr/bin/x86_64-w64-mingw32.static-ld: CMakeFiles/CaptureStream2.dir/objects.a(customizedialog.cpp.obj):customizedialog.cpp:(.text$_ZN15CustomizeDialog12loadSettingsEv+0xd9): undefined reference to `Settings::tagSpaceFlag()'
/opt/mxe/usr/bin/x86_64-w64-mingw32.static-ld: CMakeFiles/CaptureStream2.dir/objects.a(customizedialog.cpp.obj):customizedialog.cpp:(.text$_ZN15CustomizeDialog12loadSettingsEv+0xfb): undefined reference to `Settings::nameSpaceFlag()'
/opt/mxe/usr/bin/x86_64-w64-mingw32.static-ld: CMakeFiles/CaptureStream2.dir/objects.a(customizedialog.cpp.obj):customizedialog.cpp:(.text$_ZN15CustomizeDialog12saveSettingsEv+0xbb): undefined reference to `Settings::setTagSpaceFlag(bool)'
/opt/mxe/usr/bin/x86_64-w64-mingw32.static-ld: CMakeFiles/CaptureStream2.dir/objects.a(customizedialog.cpp.obj):customizedialog.cpp:(.text$_ZN15CustomizeDialog12saveSettingsEv+0x158): undefined reference to `Settings::setNameSpaceFlag(bool)'
collect2: error: ld returned 1 exit status
make[2]: *** [CMakeFiles/CaptureStream2.dir/build.make:454: CaptureStream2.exe] エラー 1
make[1]: *** [CMakeFiles/Makefile2:86: CMakeFiles/CaptureStream2.dir/all] エラー 2
make: *** [Makefile:91: all] エラー 2






QString Settings::titleFormat(int index)
{
    QSettings s = createSettings();
    s.beginGroup(Customize::SETTING_GROUP);

    const auto& item = Customize::TITLE_ITEMS[index];
    QString value = s.value(item.key, item.defaultValue).toString();

    s.endGroup();
    return value;
}



namespace Customize {

struct Item {
    const char* key;
    const char* defaultValue;
};

static const Item TITLE_ITEMS[] = {
    { "customized_title1", "%f" },
    { "customized_title2", "%k_%Y_%M_%D" }
};

static const Item FILENAME_ITEMS[] = {
    { "customized_file_name1", "%k_%Y_%M_%D" },
    { "customized_file_name2", "%k_%Y_%M_%D" }
};

static const int ITEM_COUNT = 2;

}




#ifndef CONSTANTS_H
#define CONSTANTS_H

#include <QString>
#include <QStringList>

namespace Customize {

    static const QString SETTING_GROUP = QStringLiteral("CustomizeDialog");

    static const QStringList COURSES = {
        QStringLiteral("json"),
        QStringLiteral("xml")
    };

    static const QStringList TITLE_KEYS = {
        QStringLiteral("customized_title1"),
        QStringLiteral("customized_title2")
    };

    static const QStringList FILENAME_KEYS = {
        QStringLiteral("customized_file_name1"),
        QStringLiteral("customized_file_name2")
    };

    static const QStringList TITLE_DEFAULTS = {
        QStringLiteral("%f"),
        QStringLiteral("%k_%Y_%M_%D")
    };

    static const QStringList FILENAME_DEFAULTS = {
        QStringLiteral("%k_%Y_%M_%D"),
        QStringLiteral("%k_%Y_%M_%D")
    };

    // 個別デフォルト（UI ラジオボタン用）
    static const QString DEFAULT_FILENAME  = "%k_%Y_%M_%D";
    static const QString DEFAULT_FILENAME1 = "%f_%Y_%M_%D";
    static const QString DEFAULT_FILENAME2 = "%k_%Y-%M-%D";
    static const QString DEFAULT_FILENAME3 = "%h";
    static const QString DEFAULT_FILENAME4 = "%f";
    static const QString DEFAULT_FILENAME5 = "%k_%h";
    static const QString DEFAULT_FILENAME6 = "%y%M%D_%k%x";

}

#endif // CONSTANTS_H




#ifndef SETTINGS_H
#define SETTINGS_H

#include <QString>
#include <QStringList>

class Settings {
public:
    static QString titleFormat(int index);
    static QString fileNameFormat(int index);

    static void setTitleFormat(int index, const QString& value);
    static void setFileNameFormat(int index, const QString& value);

    static bool tagSpaceFlag();
    static bool nameSpaceFlag();

    static void setTagSpaceFlag(bool flag);
    static void setNameSpaceFlag(bool flag);

    static void initializeDefaults();
};

#endif // SETTINGS_H


#include "settings.h"
#include "constants.h"
#include "mainwindow.h"

#include <QSettings>

static QSettings createSettings()
{
    QString path = MainWindow::ini_file_path;
    return QSettings(path + INI_FILE, QSettings::IniFormat);
}

void Settings::initializeDefaults()
{
    QSettings settings = createSettings();
    settings.beginGroup(Customize::SETTING_GROUP);

    for (int i = 0; i < Customize::COURSES.size(); ++i) {
        if (!settings.contains(Customize::TITLE_KEYS[i]))
            settings.setValue(Customize::TITLE_KEYS[i], Customize::TITLE_DEFAULTS[i]);

        if (!settings.contains(Customize::FILENAME_KEYS[i]))
            settings.setValue(Customize::FILENAME_KEYS[i], Customize::FILENAME_DEFAULTS[i]);
    }

    settings.endGroup();
}

QString Settings::titleFormat(int index)
{
    QSettings settings = createSettings();
    settings.beginGroup(Customize::SETTING_GROUP);
    QString value = settings.value(Customize::TITLE_KEYS[index], Customize::TITLE_DEFAULTS[index]).toString();
    settings.endGroup();
    return value;
}

QString Settings::fileNameFormat(int index)
{
    QSettings settings = createSettings();
    settings.beginGroup(Customize::SETTING_GROUP);
    QString value = settings.value(Customize::FILENAME_KEYS[index], Customize::FILENAME_DEFAULTS[index]).toString();
    settings.endGroup();
    return value;
}

void Settings::setTitleFormat(int index, const QString& value)
{
    QSettings settings = createSettings();
    settings.beginGroup(Customize::SETTING_GROUP);
    settings.setValue(Customize::TITLE_KEYS[index], value);
    settings.endGroup();
}

void Settings::setFileNameFormat(int index, const QString& value)
{
    QSettings settings = createSettings();
    settings.beginGroup(Customize::SETTING_GROUP);
    settings.setValue(Customize::FILENAME_KEYS[index], value);
    settings.endGroup();
}

bool Settings::tagSpaceFlag()
{
    return MainWindow::tag_space_flag;
}

bool Settings::nameSpaceFlag()
{
    return MainWindow::name_space_flag;
}

void Settings::setTagSpaceFlag(bool flag)
{
    MainWindow::tag_space_flag = flag;
}

void Settings::setNameSpaceFlag(bool flag)
{
    MainWindow::name_space_flag = flag;
}


void CustomizeDialog::formats(QString course, QString& titleFormat, QString& fileNameFormat)
{
    int index = Customize::COURSES.indexOf(course);
    if (index < 0) index = 0;

    titleFormat    = Settings::titleFormat(index);
    fileNameFormat = Settings::fileNameFormat(index);
}



void CustomizeDialog::loadSettings()
{
    ui.lineEdit->setText(
        mode == Ui::TitleMode
            ? Settings::titleFormat(0)
            : Settings::fileNameFormat(0)
    );

    ui.lineEdit_2->setText(
        mode == Ui::TitleMode
            ? Settings::titleFormat(1)
            : Settings::fileNameFormat(1)
    );

    if (mode == Ui::TitleMode)
        ui.checkBox->setChecked(Settings::tagSpaceFlag());
    else
        ui.checkBox->setChecked(Settings::nameSpaceFlag());
}


void CustomizeDialog::saveSettings()
{
    if (mode == Ui::TitleMode) {
        Settings::setTitleFormat(0, ui.lineEdit->text());
        Settings::setTitleFormat(1, ui.lineEdit_2->text());
        Settings::setTagSpaceFlag(ui.checkBox->isChecked());
    } else {
        Settings::setFileNameFormat(0, ui.lineEdit->text());
        Settings::setFileNameFormat(1, ui.lineEdit_2->text());
        Settings::setNameSpaceFlag(ui.checkBox->isChecked());
    }
}




void MainWindow::customizeScramble() {
	collectOptionalSettings();
	MainWindow::id_flag = false;
	setmap();
	optional1 = optional[0]; optional2 = optional[1];
	optional3 = optional[2]; optional4 = optional[3];
	optional5 = optional[4]; optional6 = optional[5];
	optional7 = optional[6]; optional8 = optional[7];
	QString optional_temp[] = { optional1, optional2, optional3, optional4, optional5, optional6, optional7, optional8, "NULL" };
	ScrambleDialog dialog( Settings::instance(), optional1, optional2, optional3, optional4, optional5, optional6, optional7, optional8, this );
    if (dialog.exec() ) {
    	QString pattern( "_01" );
    	pattern = QRegularExpression::anchoredPattern(pattern);
	QString optional[] = { dialog.scramble1(), dialog.scramble2(), dialog.scramble3(), dialog.scramble4(), dialog.scramble5(), dialog.scramble6(), dialog.scramble7(), dialog.scramble8(), "NULL" };	
	QString title[8];
	for ( int i = 0; optional[i] != "NULL"; i++ ) {
		if ( id_map.contains( optional[i] ) ) title[i] = id_map.value( optional[i] );
		if ( title[i]  == "" ) { title[i] = Utility::getProgram_name( optional[i] ); }
		if ( title[i]  == "" || optional[i]  == "error" ) { optional[i] = optional_temp[i]; title[i] = Utility::getProgram_name( optional[i] ); }
	}
	optional1 = optional[0]; optional2 = optional[1];
	optional3 = optional[2]; optional4 = optional[3];
	optional5 = optional[4]; optional6 = optional[5];
	optional7 = optional[6]; optional8 = optional[7];
	program_title1 = title[0]; program_title2 = title[1];
	program_title3 = title[2]; program_title4 = title[3];
	program_title5 = title[4]; program_title6 = title[5];
	program_title7 = title[6]; program_title8 = title[7];

	QString program_title[] = { program_title1, program_title2, program_title3, program_title4, program_title5, program_title6, program_title7, program_title8, "NULL" };
	QAbstractButton* checkboxx[] = { ui->toolButton_optional1, ui->toolButton_optional2,
					 ui->toolButton_optional3, ui->toolButton_optional4,
					 ui->toolButton_optional5, ui->toolButton_optional6,
					 ui->toolButton_optional7, ui->toolButton_optional8,
					 NULL
		 	};
	bool flag = false;
	for ( int i = 0; program_title[i] != "NULL"; i++ ) {
		if ( optional[i] == optional_temp[i] && checkboxx[i]->isChecked() ) flag = true; else flag = false;
				checkboxx[i]->setChecked(false);
				checkboxx[i]->setText( QString( program_title[i] ) );
				if ( flag ) checkboxx[i]->setChecked( true );
	}

	optional1 = optional[0]; optional2 = optional[1]; optional3 = optional[2]; optional4 = optional[3];
	optional5 = optional[4]; optional6 = optional[5]; optional7 = optional[6]; optional8 = optional[7];
	ScrambleDialog dialog( Settings::instance(), optional1, optional2, optional3, optional4, optional5, optional6, optional7, optional8, this );

    }
}






















[MainWindow]
audio_extension=@ByteArray(m4a)
basic0=false
basic1=false
basic2=false
business1=false
detailed_message=false
enjoy=false
ffmpeg_folder=Z:\\home\\kazuo\\cs\\CaptureStream2\\debug\\[前週]\\ステップアップハングル講座\\
gendai=false
geometry=@ByteArray(\x1\xd9\xd0\xcb\0\x3\0\0\0\0\x2\xa4\0\0\x1[\0\0\x4\xbf\0\0\x3}\0\0\x2\xa4\0\0\x1\x80\0\0\x4\xbf\0\0\x3}\0\0\0\0\0\0\0\0\a\x80\0\0\x2\xa4\0\0\x1\x80\0\0\x4\xbf\0\0\x3})
kaiwa=true
koza_separation=true
multi_gui=true
name_space=true
opt_title1=@ByteArray(\xe3\x81\xbe\xe3\x81\x84\xe3\x81\xab\xe3\x81\xa1\xe3\x83\x95\xe3\x83\xa9\xe3\x83\xb3\xe3\x82\xb9\xe8\xaa\x9e)
opt_title2=@ByteArray(\xe3\x81\xbe\xe3\x81\x84\xe3\x81\xab\xe3\x81\xa1\xe3\x83\x89\xe3\x82\xa4\xe3\x83\x84\xe8\xaa\x9e)
opt_title3=@ByteArray(\xe3\x81\xbe\xe3\x81\x84\xe3\x81\xab\xe3\x81\xa1\xe3\x82\xa4\xe3\x82\xbf\xe3\x83\xaa\xe3\x82\xa2\xe8\xaa\x9e)
opt_title4=@ByteArray(\xe3\x81\xbe\xe3\x81\x84\xe3\x81\xab\xe3\x81\xa1\xe3\x82\xb9\xe3\x83\x9a\xe3\x82\xa4\xe3\x83\xb3\xe8\xaa\x9e)
opt_title5=@ByteArray(\xe3\x81\xbe\xe3\x81\x84\xe3\x81\xab\xe3\x81\xa1\xe3\x83\xad\xe3\x82\xb7\xe3\x82\xa2\xe8\xaa\x9e)
opt_title6=@ByteArray(\xe3\x83\x9d\xe3\x83\xab\xe3\x83\x88\xe3\x82\xac\xe3\x83\xab\xe8\xaa\x9e)
opt_title7=@ByteArray(\xe3\x81\xbe\xe3\x81\x84\xe3\x81\xab\xe3\x81\xa1\xe4\xb8\xad\xe5\x9b\xbd\xe8\xaa\x9e)
opt_title8=@ByteArray(\xe3\x81\xbe\xe3\x81\x84\xe3\x81\xab\xe3\x81\xa1\xe3\x83\x8f\xe3\x83\xb3\xe3\x82\xb0\xe3\x83\xab\xe8\xac\x9b\xe5\xba\xa7)
optional1=XQ487ZM61K_01
optional2=N8PZRZ9WQY_01
optional3=LJWZP7XVMX_01
optional4=NRZWXVGQ19_01
optional5=YRLK72JZ7Q_01
optional6=N13V9K157Y_01
optional7=983PKQPYN7_01
optional8=LR47WW9K14_01
optional_1=false
optional_2=false
optional_3=false
optional_4=false
optional_5=false
optional_6=false
optional_7=false
optional_8=false
save_folder=Z:/home/kazuo/cs/CaptureStream2/debug/[前週]/まいにちイタリア語【応用編】\\
skip=true
spec_title1=@ByteArray(\xe3\x82\x84\xe3\x81\x95\xe3\x81\x97\xe3\x81\x84\xe6\x97\xa5\xe6\x9c\xac\xe8\xaa\x9e)
spec_title2=@ByteArray(\xe3\x82\xa2\xe3\x83\xa9\xe3\x83\x93\xe3\x82\xa2\xe8\xaa\x9e\xe8\xac\x9b\xe5\xba\xa7)
spec_title3=@ByteArray(Asian View)
spec_title4=@ByteArray(Living in Japan)
special1=6LPPKP6W8Q_01
special2=WKMNWGMN6R_01
special3=GLZQ4M519X_01
special4=4MY6Q8XP88_01
special_1=false
special_2=false
special_3=false
special_4=false
tag_space=false
this_week=true
thumbnail=true
timetrial=false

[MessageWindow]
geometry=@ByteArray(\x1\xd9\xd0\xcb\0\x3\0\0\0\0\x2\xa4\0\0\x3\xba\0\0\x4\xbf\0\0\x4\xe5\0\0\x2\xa4\0\0\x3\xba\0\0\x4\xbf\0\0\x4\xe5\0\0\0\0\0\0\0\0\a\x80\0\0\x2\xa4\0\0\x3\xba\0\0\x4\xbf\0\0\x4\xe5)










54 785.0 FAILED: lib/libQt6XcbQpa.so.6.9.0 
#54 785.0 : && /usr/bin/c++ -fPIC -fPIC -DNDEBUG -O2  -L/usr/local/lib   -Wl,-Bsymbolic-functions -Wl,--no-undefined -Wl,-z,relro,-z,now -Wl,--enable-new-dtags -shared -Wl,-soname,libQt6XcbQpa.so.6 -o lib/libQt6XcbQpa.so.6.9.0 src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/XcbQpaPrivate_autogen/mocs_compilation.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/gl_integrations/qxcbglintegration.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/gl_integrations/qxcbglintegrationfactory.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/gl_integrations/qxcbnativeinterfacehandler.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbatom.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbbackingstore.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbclipboard.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbconnection.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbconnection_basic.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbconnection_screens.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbconnection_xi2.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbcursor.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbeventdispatcher.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbeventqueue.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbimage.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbintegration.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbkeyboard.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbscrollingdevice.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbmime.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbnativeinterface.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbscreen.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbsystemtraytracker.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbwindow.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbwmsupport.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbxsettings.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbdrag.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qt_xlib_wrapper.c.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbsessionmanager.cpp.o src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/__/__/__/3rdparty/xcb/libxcb/xinput.c.o  -Wl,-rpath,/build/qt-build/lib:  /usr/local/lib/libxcb-cursor.a  /usr/local/lib/libxcb-icccm.so  /usr/local/lib/libxcb-image.so  /usr/local/lib/libxcb-keysyms.so  /usr/local/lib/libxcb-randr.a  /usr/local/lib/libxcb-render.a  /usr/local/lib/libxcb-render-util.so  /usr/local/lib/libxcb-shape.a  /usr/local/lib/libxcb-shm.a  /usr/local/lib/libxcb-sync.a  /usr/local/lib/libxcb.a  /usr/local/lib/libxcb-xfixes.a  /usr/local/lib/libxcb-xkb.a  /usr/local/lib/x86_64-linux-gnu/libxkbcommon.a  /usr/local/lib/libX11-xcb.a  /usr/local/lib/libX11.a  /usr/local/lib/libSM.a  /usr/local/lib/libICE.a  -ldl  /usr/local/lib/x86_64-linux-gnu/libxkbcommon-x11.a  /usr/local/lib/x86_64-linux-gnu/libxkbcommon.a  /usr/local/lib/libxcb-xkb.a  /usr/local/lib/libxcb.a  /usr/local/lib/libXau.a  /usr/local/lib/libXdmcp.a  /usr/local/lib/libXau.a  /usr/local/lib/libXdmcp.a  lib/libQt6Gui.so.6.9.0  /usr/lib/x86_64-linux-gnu/libGLESv2.so  /usr/lib/x86_64-linux-gnu/libEGL.so  lib/libQt6Core.so.6.9.0  /usr/local/lib/libxcb-render.a  /usr/local/lib/libxcb-shape.a  /usr/local/lib/libxcb.a  -Wl,-rpath-link,/build/qt-build/lib && :
#54 785.0 /usr/bin/ld: src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbwindow.cpp.o: in function `QXcbWindow::propagateSizeHints()':
#54 785.0 qxcbwindow.cpp:(.text+0x9e2): undefined reference to `xcb_icccm_size_hints_set_win_gravity'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0xa72): undefined reference to `xcb_icccm_size_hints_set_min_size'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0xab0): undefined reference to `xcb_icccm_size_hints_set_max_size'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0xaf1): undefined reference to `xcb_icccm_size_hints_set_base_size'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0xb01): undefined reference to `xcb_icccm_size_hints_set_resize_inc'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0xb14): undefined reference to `xcb_icccm_set_wm_normal_hints'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0xb72): undefined reference to `xcb_icccm_size_hints_set_size'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0xb92): undefined reference to `xcb_icccm_size_hints_set_resize_inc'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0xbb1): undefined reference to `xcb_icccm_size_hints_set_position'
#54 785.0 /usr/bin/ld: src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbwindow.cpp.o: in function `QXcbWindow::updateDoesNotAcceptFocus(bool)':
#54 785.0 qxcbwindow.cpp:(.text+0x2320): undefined reference to `xcb_icccm_get_wm_hints_unchecked'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0x2334): undefined reference to `xcb_icccm_get_wm_hints_reply'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0x2347): undefined reference to `xcb_icccm_wm_hints_set_input'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0x235a): undefined reference to `xcb_icccm_set_wm_hints'
#54 785.0 /usr/bin/ld: src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbwindow.cpp.o: in function `QXcbWindow::setWindowState(QFlags<Qt::WindowState>)':
#54 785.0 qxcbwindow.cpp:(.text+0x3819): undefined reference to `xcb_icccm_get_wm_hints_unchecked'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0x382d): undefined reference to `xcb_icccm_get_wm_hints_reply'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0x386e): undefined reference to `xcb_icccm_wm_hints_set_normal'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0x3881): undefined reference to `xcb_icccm_set_wm_hints'
#54 785.0 /usr/bin/ld: qxcbwindow.cpp:(.text+0x3959): undefined reference to `xcb_icccm_wm_hints_set_iconic'
#54 785.0 /usr/bin/ld: src/plugins/platforms/xcb/CMakeFiles/XcbQpaPrivate.dir/qxcbwindow.cpp.o: in function `QXcbWindow::create()':
#54 785.0 qxcbwindow.cpp:(.text+0x8549): undefined reference to `xcb_icccm_set_wm_hints'
#54 785.0 collect2: error: ld returned 1 exit status
#54 785.1 [1626/1826] Building CXX object src/plugins/platforms/eglfs/CMakeFiles/EglFSDeviceIntegrationPrivate.dir/api/qeglfsoffscreenwindow.cpp.o
#54 786.7 [1627/1826] Building CXX object src/plugins/platforms/eglfs/CMakeFiles/EglFSDeviceIntegrationPrivate.dir/api/qeglfsintegration.cpp.o
#54 787.2 [1628/1826] Building CXX object src/plugins/platforms/eglfs/CMakeFiles/EglFSDeviceIntegrationPrivate.dir/api/qeglfsscreen.cpp.o
#54 788.7 [1629/1826] Building CXX object src/openglwidgets/CMakeFiles/OpenGLWidgets.dir/cmake_pch.hxx.gch
#54 789.8 [1630/1826] Building CXX object src/printsupport/CMakeFiles/PrintSupport.dir/cmake_pch.hxx.gch
#54 789.8 ninja: build stopped: subcommand failed.


#40 [36/49] RUN find /usr/local/lib -name "*.a" -exec echo "Checking {}" ; -exec nm {} ; | grep xcb_icccm_ || echo "OK: xcb_icccm_ not found"
#40 0.123 libxcb_icccm_la-icccm.o:
#40 0.123 0000000000000000 T xcb_icccm_get_text_property
#40 0.123 000000000000008a T xcb_icccm_get_text_property_reply
#40 0.123 0000000000000147 T xcb_icccm_get_text_property_reply_wipe
#40 0.123 0000000000000045 T xcb_icccm_get_text_property_unchecked
#40 0.123 00000000000007da T xcb_icccm_get_wm_class
#40 0.123 0000000000000868 T xcb_icccm_get_wm_class_from_reply
#40 0.123 000000000000095a T xcb_icccm_get_wm_class_reply
#40 0.123 00000000000009bc T xcb_icccm_get_wm_class_reply_wipe
#40 0.123 0000000000000821 T xcb_icccm_get_wm_class_unchecked
#40 0.123 00000000000006b8 T xcb_icccm_get_wm_client_machine
#40 0.123 000000000000070e T xcb_icccm_get_wm_client_machine_reply
#40 0.123 00000000000006e3 T xcb_icccm_get_wm_client_machine_unchecked
#40 0.123 000000000000046f T xcb_icccm_get_wm_colormap_windows
#40 0.123 00000000000004f9 T xcb_icccm_get_wm_colormap_windows_from_reply
#40 0.123 0000000000000587 T xcb_icccm_get_wm_colormap_windows_reply
#40 0.123 00000000000005e9 T xcb_icccm_get_wm_colormap_windows_reply_wipe
#40 0.123 00000000000004b4 T xcb_icccm_get_wm_colormap_windows_unchecked
#40 0.123 000000000000139c T xcb_icccm_get_wm_hints
#40 0.123 0000000000001424 T xcb_icccm_get_wm_hints_from_reply
#40 0.123 00000000000014e4 T xcb_icccm_get_wm_hints_reply
#40 0.123 00000000000013e0 T xcb_icccm_get_wm_hints_unchecked
#40 0.123 000000000000034b T xcb_icccm_get_wm_icon_name
#40 0.123 00000000000003a1 T xcb_icccm_get_wm_icon_name_reply
#40 0.123 0000000000000376 T xcb_icccm_get_wm_icon_name_unchecked
#40 0.123 0000000000000215 T xcb_icccm_get_wm_name
#40 0.123 000000000000026b T xcb_icccm_get_wm_name_reply
#40 0.123 0000000000000240 T xcb_icccm_get_wm_name_unchecked
#40 0.123 00000000000010c6 T xcb_icccm_get_wm_normal_hints
#40 0.123 000000000000111c T xcb_icccm_get_wm_normal_hints_reply
#40 0.123 00000000000010f1 T xcb_icccm_get_wm_normal_hints_unchecked
#40 0.123 00000000000015dc T xcb_icccm_get_wm_protocols
#40 0.123 0000000000001666 T xcb_icccm_get_wm_protocols_from_reply
#40 0.123 00000000000016f4 T xcb_icccm_get_wm_protocols_reply
#40 0.123 0000000000001756 T xcb_icccm_get_wm_protocols_reply_wipe
#40 0.123 0000000000001621 T xcb_icccm_get_wm_protocols_unchecked
#40 0.123 0000000000000e7a T xcb_icccm_get_wm_size_hints
#40 0.123 0000000000000f04 T xcb_icccm_get_wm_size_hints_from_reply
#40 0.123 0000000000001002 T xcb_icccm_get_wm_size_hints_reply
#40 0.123 0000000000000ebf T xcb_icccm_get_wm_size_hints_unchecked
#40 0.123 0000000000000a6f T xcb_icccm_get_wm_transient_for
#40 0.123 0000000000000af7 T xcb_icccm_get_wm_transient_for_from_reply
#40 0.123 0000000000000b57 T xcb_icccm_get_wm_transient_for_reply
#40 0.123 0000000000000ab3 T xcb_icccm_get_wm_transient_for_unchecked
#40 0.123 000000000000078e T xcb_icccm_set_wm_class
#40 0.123 0000000000000742 T xcb_icccm_set_wm_class_checked
#40 0.123 0000000000000662 T xcb_icccm_set_wm_client_machine
#40 0.123 000000000000060c T xcb_icccm_set_wm_client_machine_checked
#40 0.123 0000000000000422 T xcb_icccm_set_wm_colormap_windows
#40 0.123 00000000000003d5 T xcb_icccm_set_wm_colormap_windows_checked
#40 0.123 0000000000001355 T xcb_icccm_set_wm_hints
#40 0.123 000000000000130e T xcb_icccm_set_wm_hints_checked
#40 0.123 00000000000002f5 T xcb_icccm_set_wm_icon_name
#40 0.123 000000000000029f T xcb_icccm_set_wm_icon_name_checked
#40 0.123 00000000000001bf T xcb_icccm_set_wm_name
#40 0.123 0000000000000169 T xcb_icccm_set_wm_name_checked
#40 0.123 0000000000001092 T xcb_icccm_set_wm_normal_hints
#40 0.123 000000000000105e T xcb_icccm_set_wm_normal_hints_checked
#40 0.123 000000000000158f T xcb_icccm_set_wm_protocols
#40 0.123 0000000000001542 T xcb_icccm_set_wm_protocols_checked
#40 0.123 0000000000000e32 T xcb_icccm_set_wm_size_hints
#40 0.123 0000000000000dea T xcb_icccm_set_wm_size_hints_checked
#40 0.123 0000000000000a27 T xcb_icccm_set_wm_transient_for
#40 0.123 00000000000009df T xcb_icccm_set_wm_transient_for_checked
#40 0.123 0000000000000d2f T xcb_icccm_size_hints_set_aspect
#40 0.123 0000000000000d83 T xcb_icccm_size_hints_set_base_size
#40 0.123 0000000000000cbb T xcb_icccm_size_hints_set_max_size
#40 0.123 0000000000000c81 T xcb_icccm_size_hints_set_min_size
#40 0.123 0000000000000bb3 T xcb_icccm_size_hints_set_position
#40 0.123 0000000000000cf5 T xcb_icccm_size_hints_set_resize_inc
#40 0.123 0000000000000c1a T xcb_icccm_size_hints_set_size
#40 0.123 0000000000000dbd T xcb_icccm_size_hints_set_win_gravity
#40 0.123 0000000000001150 T xcb_icccm_wm_hints_get_urgency
#40 0.123 0000000000001267 T xcb_icccm_wm_hints_set_icon_mask
#40 0.123 000000000000123a T xcb_icccm_wm_hints_set_icon_pixmap
#40 0.123 0000000000001294 T xcb_icccm_wm_hints_set_icon_window
#40 0.123 0000000000001199 T xcb_icccm_wm_hints_set_iconic
#40 0.123 0000000000001169 T xcb_icccm_wm_hints_set_input
#40 0.123 000000000000121a T xcb_icccm_wm_hints_set_none
#40 0.395 00000000000011c4 T xcb_icccm_wm_hints_set_normal
#40 0.395 00000000000012ee T xcb_icccm_wm_hints_set_urgency
#40 0.395 00000000000012c1 T xcb_icccm_wm_hints_set_window_group
#40 0.395 00000000000011ef T xcb_icccm_wm_hints_set_withdrawn
#40 DONE 0.4s


#19 [15/48] RUN pkg-config --static --libs xcb &&     ldd /usr/local/lib/libxcb.so || true &&     nm -g /usr/local/lib/libxcb.a | grep Xau || true
#19 0.125 -L/usr/local/lib -lxcb -lXau -lXdmcp -lXau -lXdmcp
#19 0.126 ldd: /usr/local/lib/libxcb.so: No such file or directory
#19 0.132                  U XauDisposeAuth
#19 0.132                  U XauGetBestAuthByAddr
#19 DONE 0.1s


#26 0.122 === Check symbols in libfreetype.a ===
#26 0.123 + nm /usr/local/lib/libfreetype.a
#26 0.123 + grep hb_
#26 0.137                  U hb_blob_create
#26 0.137                  U hb_blob_destroy
#26 0.137                  U hb_buffer_add_utf8
#26 0.137                  U hb_buffer_clear_contents
#26 0.137                  U hb_buffer_create
#26 0.137                  U hb_buffer_destroy
#26 0.137                  U hb_buffer_get_glyph_infos
#26 0.137                  U hb_buffer_get_glyph_positions
#26 0.137                  U hb_buffer_get_length
#26 0.137                  U hb_buffer_guess_segment_properties
#26 0.137                  U hb_face_create
#26 0.137                  U hb_face_create_for_tables
#26 0.137                  U hb_face_destroy
#26 0.137                  U hb_face_set_index
#26 0.137                  U hb_face_set_upem
#26 0.137                  U hb_font_create
#26 0.137                  U hb_font_destroy
#26 0.137                  U hb_font_get_face
#26 0.137                  U hb_font_set_scale
#26 0.137 00000000000022e0 t hb_ft_reference_table_
#26 0.137                  U hb_ot_layout_collect_lookups
#26 0.137                  U hb_ot_layout_lookup_collect_glyphs
#26 0.137                  U hb_ot_layout_lookup_would_substitute
#26 0.137                  U hb_ot_tags_from_script_and_language
#26 0.137                  U hb_set_create
#26 0.137                  U hb_set_destroy
#26 0.137                  U hb_set_is_empty
#26 0.137                  U hb_set_next
#26 0.137                  U hb_set_subtract
#26 0.137                  U hb_shape
#26 DONE 0.1s


#25 12.43 + echo ===== Begin make install =====
#25 12.43 + make install
#25 12.46 rm -rf /usr/local/include/freetype2
#25 12.46 rm -f /usr/local/include/ft2build.h
#25 12.46 /usr/bin/mkdir -p /usr/local/lib                               \
#25 12.46                          /usr/local/lib/pkgconfig                     \
#25 12.46                          /usr/local/include/freetype2/freetype/config \
#25 12.46                          /usr/local/share/aclocal
#25 12.47 ./builds/unix/libtool --mode=install /usr/bin/install -c                             \
#25 12.47                                   /freetype-2.13.2/objs/libfreetype.la /usr/local/lib
#25 12.49 libtool: install: /usr/bin/install -c /freetype-2.13.2/objs/.libs/libfreetype.lai /usr/local/lib/libfreetype.la
#25 12.50 libtool: install: /usr/bin/install -c /freetype-2.13.2/objs/.libs/libfreetype.a /usr/local/lib/libfreetype.a
#25 12.50 libtool: install: chmod 644 /usr/local/lib/libfreetype.a
#25 12.51 libtool: install: ranlib /usr/local/lib/libfreetype.a
#25 12.57 libtool: finish: PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/sbin" ldconfig -n /usr/local/lib
#25 12.57 ----------------------------------------------------------------------
#25 12.57 Libraries have been installed in:
#25 12.57    /usr/local/lib
#25 12.57 
#25 12.57 If you ever happen to want to link against installed libraries
#25 12.57 in a given directory, LIBDIR, you must either use libtool, and
#25 12.57 specify the full pathname of the library, or use the '-LLIBDIR'
#25 12.57 flag during linking and do at least one of the following:
#25 12.57    - add LIBDIR to the 'LD_LIBRARY_PATH' environment variable
#25 12.57      during execution
#25 12.57    - add LIBDIR to the 'LD_RUN_PATH' environment variable
#25 12.57      during linking
#25 12.57    - use the '-Wl,-rpath -Wl,LIBDIR' linker flag
#25 12.57    - have your system administrator add LIBDIR to '/etc/ld.so.conf'
#25 12.57 
#25 12.57 See any operating system documentation about shared libraries for
#25 12.57 more information, such as the ld(1) and ld.so(8) manual pages.
#25 12.57 ----------------------------------------------------------------------
#25 11.20 ----------------------------------------------------------------------
#25 11.20 for P in /freetype-2.13.2/include/freetype/freetype.h /freetype-2.13.2/include/freetype/ftadvanc.h /freetype-2.13.2/include/freetype/ftbbox.h /freetype-2.13.2/include/freetype/ftbdf.h /freetype-2.13.2/include/freetype/ftbitmap.h /freetype-2.13.2/include/freetype/ftbzip2.h /freetype-2.13.2/include/freetype/ftcache.h /freetype-2.13.2/include/freetype/ftchapters.h /freetype-2.13.2/include/freetype/ftcid.h /freetype-2.13.2/include/freetype/ftcolor.h /freetype-2.13.2/include/freetype/ftdriver.h /freetype-2.13.2/include/freetype/fterrdef.h /freetype-2.13.2/include/freetype/fterrors.h /freetype-2.13.2/include/freetype/ftfntfmt.h /freetype-2.13.2/include/freetype/ftgasp.h /freetype-2.13.2/include/freetype/ftglyph.h /freetype-2.13.2/include/freetype/ftgxval.h /freetype-2.13.2/include/freetype/ftgzip.h /freetype-2.13.2/include/freetype/ftimage.h /freetype-2.13.2/include/freetype/ftincrem.h /freetype-2.13.2/include/freetype/ftlcdfil.h /freetype-2.13.2/include/freetype/ftlist.h /freetype-2.13.2/include/freetype
#25 11.20           /usr/bin/install -c -m 644                                    \
#25 11.20             $P /usr/local/include/freetype2/freetype ; \
#25 11.20         done
#25 11.26 for P in /freetype-2.13.2/include/freetype/config/ftconfig.h /freetype-2.13.2/include/freetype/config/ftheader.h /freetype-2.13.2/include/freetype/config/ftmodule.h /freetype-2.13.2/include/freetype/config/ftoption.h /freetype-2.13.2/include/freetype/config/ftstdlib.h /freetype-2.13.2/include/freetype/config/integer-types.h /freetype-2.13.2/include/freetype/config/mac-support.h /freetype-2.13.2/include/freetype/config/public-macros.h  /freetype-2.13.2/objs/ftmodule.h ./builds/unix/ftoption.h ; do                                  \
#25 11.26           /usr/bin/install -c -m 644                                           \
#25 11.26             $P /usr/local/include/freetype2/freetype/config ; \
#25 11.26         done
#25 11.27 /usr/bin/install -c -m 644 /freetype-2.13.2/include/ft2build.h                  \
#25 11.27           /usr/local/include/freetype2/ft2build.h
#25 11.27 /usr/bin/install -c -m 644 ./builds/unix/ftconfig.h                        \
#25 11.27           /usr/local/include/freetype2/freetype/config/ftconfig.h
#25 11.27 /usr/bin/install -c -m 644 /freetype-2.13.2/objs/ftmodule.h                          \
#25 11.27           /usr/local/include/freetype2/freetype/config/ftmodule.h
#25 11.27 /usr/bin/install -c -m 644 ./builds/unix/ftoption.h                        \
#25 11.27           /usr/local/include/freetype2/freetype/config/ftoption.h
#25 11.28 /usr/bin/install -c -m 644 ./builds/unix/freetype2.m4          \
#25 11.28           /usr/local/share/aclocal/freetype2.m4
#25 11.28 /usr/bin/install -c -m 644 ./builds/unix/freetype2.pc             \
#25 11.28           /usr/local/lib/pkgconfig/freetype2.pc
#25 11.28 + echo ===== Freetype build with harfbuzz completed =====
#25 11.28 ===== Freetype build with harfbuzz completed =====
#25 DONE 11.3s
#26 [22/45] RUN set -ex &&     echo "=== freetype-config ===" && freetype-config --libs &&     echo "=== Check symbols in libfreetype.a ===" &&     nm /usr/local/lib/libfreetype.a | grep hb_ || echo "No harfbuzz symbols found"
#26 0.122 + echo === freetype-config ===
#26 0.122 + freetype-config --libs
#26 0.122 === freetype-config ===
#26 0.122 /bin/sh: 1: freetype-config: not found
#26 0.122 + echo No harfbuzz symbols found
#26 0.122 No harfbuzz symbols found
#26 DONE 0.1s
作成済み
# libpthread-stubs
# xtrans
# libXext
# libICE
# libSM
# zlib (静的ビルド強制)
# libpng
# freetype
# fontconfig
# libxkbfile (optional)
# libXfixes
# libXrandr
# libXi
# libXinerama
# xcb-util
# xcb-util-image
# xcb-util-keysyms
# xcb-util-renderutil
# xcb-util-wm
# xcb-util-cursor
# libXrender
# xorgproto (プロトコル定義)
# xcb-proto 
# libXau
# libXdmcp
# libxcb
# libX11
# libxml-2.0
# Build libxkbcommon

不足分
xcb-shape	libxcb-shape
xcb-xkb	libxcb-xkb
xcb-shm	libxcb-shm
xcb-shm	libxcb-shm
xcb-icccm	libxcb-icccm
xkbcommon-x11	libxkbcommon-x11
X11	libX11
glib	libglib-2.0
pthread	libpthread







echo $CR_PAT | docker login ghcr.io -u csreviser --password-stdin

docker pull alpine:3.18
docker tag alpine:3.18 ghcr.io/csreviser/qt6-static-builder:init
docker push ghcr.io/csreviser/qt6-static-builder:init


error while loading shared libraries: libxkbcommon-x11.so.0: cannot open shared object file: No such file or directory

tar -czf mxe-fixed.tar.gz --owner=0 --group=0 -C ./


#!/usr/bin/env bash
set -e

SRC_DIR="$PWD/qt-everywhere-src-6.9.0"
BUILD_DIR="$PWD/qt-build"
INSTALL_DIR="$BUILD_DIR/qt6-static-install"

cd "$SRC_DIR"

./configure -top-level \
  -prefix "$INSTALL_DIR" \
  -static -static-runtime -release \
  -opensource -confirm-license \
  -nomake tests -nomake examples \
  -no-pch \
  -qt-harfbuzz -qt-pcre -qt-zlib \
  -platform linux-g++ \
  -c++std c++20 \
  -skip qt3d -skip qtactiveqt -skip qtcharts -skip qtconnectivity \
  -skip qtdatavis3d -skip qtdoc -skip qtgamepad -skip qtgraphicaleffects \
  -skip qtimageformats -skip qtlocation -skip qtmacextras -skip qtnetworkauth \
  -skip qtpurchasing -skip qtquick3d -skip qtquickcontrols \
  -skip qtquickcontrols2 -skip qtremoteobjects -skip qtscxml \
  -skip qtsensors -skip qtserialbus -skip qtserialport -skip qtspeech \
  -skip qttools -skip qttranslations -skip qtvirtualkeyboard -skip qtwayland \
  -skip qtwebchannel -skip qtwebengine -skip qtwebsockets \
  -skip qtwebview -skip qtwinextras -skip qtlottie -skip qtmultimedia \
  -skip qtpositioning -skip qtquicktimeline \
  # 含めるのは qtbase（デフォルト）+ qtsvg のみ

cmake --build "$BUILD_DIR" --parallel
cmake --install "$BUILD_DIR"
#!/usr/bin/env bash
set -e

# ビルド用ディレクトリ
SRC_DIR="$PWD/qt-everywhere-src-6.9.0"
BUILD_DIR="$PWD/qt-build"
INSTALL_DIR="$BUILD_DIR/qt6-static-install"

# ソース取得済み前提
cd "$SRC_DIR"

# configure 実行
./configure -top-level \
  -prefix "$INSTALL_DIR" \
  -static -static-runtime -release \
  -opensource -confirm-license \
  -nomake examples -nomake tests \
  -no-pch \
  -qt-harfbuzz -qt-pcre -qt-zlib \
  -platform linux-g++ \
  -c++std c++20 \
  -skip qt3d -skip qtactiveqt -skip qtcharts -skip qtconnectivity \
  -skip qtdatavis3d -skip qtdoc -skip qtgamepad -skip qtgraphicaleffects \
  -skip qtimageformats -skip qtlocation -skip qtmacextras -skip qtnetworkauth \
  -skip qtpurchasing -skip qtquick3d -skip qtquickcontrols \
  -skip qtquickcontrols2 -skip qtremoteobjects -skip qtscxml \
  -skip qtsensors -skip qtserialbus -skip qtserialport -skip qtspeech \
  -skip qtsvg -skip qttools -skip qttranslations -skip qtvirtualkeyboard \
  -skip qtwayland -skip qtwebchannel -skip qtwebengine -skip qtwebsockets \
  -skip qtwebview -skip qtwinextras -skip qtlottie -skip qtmultimedia \
  -skip qtshadertools -skip qtpositioning -skip qtquicktimeline

# ビルドとインストール
cmake --build "$BUILD_DIR" --parallel
cmake --install "$BUILD_DIR"

-- Found X11_XCB: /usr/lib/x86_64-linux-gnu/libX11-xcb.so (found version "1.8.7")
-- Found XCB_XCB: /usr/lib/x86_64-linux-gnu/libxcb.so (found version "1.15")
-- Found XCB_RENDER: /usr/lib/x86_64-linux-gnu/libxcb-render.so (found version "1.15")
-- Found XCB_SHAPE: /usr/lib/x86_64-linux-gnu/libxcb-shape.so (found version "1.15")
-- Found XCB_XFIXES: /usr/lib/x86_64-linux-gnu/libxcb-xfixes.so (found version "1.15")
-- Found XCB_SHM: /usr/lib/x86_64-linux-gnu/libxcb-shm.so (found version "1.15")
-- Could NOT find XCB_ATOM (missing: XCB_ATOM_LIBRARY XCB_ATOM_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_AUX (missing: XCB_AUX_LIBRARY XCB_AUX_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_COMPOSITE (missing: XCB_COMPOSITE_LIBRARY XCB_COMPOSITE_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_CURSOR (missing: XCB_CURSOR_LIBRARY XCB_CURSOR_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_DAMAGE (missing: XCB_DAMAGE_LIBRARY XCB_DAMAGE_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_DPMS (missing: XCB_DPMS_LIBRARY XCB_DPMS_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_DRI2 (missing: XCB_DRI2_LIBRARY XCB_DRI2_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_DRI3 (missing: XCB_DRI3_LIBRARY XCB_DRI3_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_EVENT (missing: XCB_EVENT_LIBRARY XCB_EVENT_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_EWMH (missing: XCB_EWMH_LIBRARY XCB_EWMH_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_GLX (missing: XCB_GLX_LIBRARY XCB_GLX_INCLUDE_DIR) (found version "")
-- Found XCB_ICCCM: /usr/lib/x86_64-linux-gnu/libxcb-icccm.so (found version "0.4.1")
-- Found XCB_IMAGE: /usr/lib/x86_64-linux-gnu/libxcb-image.so (found version "0.4.0")
-- Found XCB_KEYSYMS: /usr/lib/x86_64-linux-gnu/libxcb-keysyms.so (found version "0.4.0")
-- Could NOT find XCB_PRESENT (missing: XCB_PRESENT_LIBRARY XCB_PRESENT_INCLUDE_DIR) (found version "")
-- Found XCB_RANDR: /usr/lib/x86_64-linux-gnu/libxcb-randr.so (found version "1.15")
-- Could NOT find XCB_RECORD (missing: XCB_RECORD_LIBRARY XCB_RECORD_INCLUDE_DIR) (found version "")
-- Found XCB_RENDERUTIL: /usr/lib/x86_64-linux-gnu/libxcb-render-util.so (found version "0.3.9")
-- Could NOT find XCB_RES (missing: XCB_RES_LIBRARY XCB_RES_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_SCREENSAVER (missing: XCB_SCREENSAVER_LIBRARY XCB_SCREENSAVER_INCLUDE_DIR) (found version "")
-- Found XCB_SYNC: /usr/lib/x86_64-linux-gnu/libxcb-sync.so (found version "1.15")
-- Could NOT find XCB_UTIL (missing: XCB_UTIL_LIBRARY XCB_UTIL_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_XEVIE (missing: XCB_XEVIE_LIBRARY XCB_XEVIE_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_XF86DRI (missing: XCB_XF86DRI_LIBRARY XCB_XF86DRI_INCLUDE_DIR) (found version "")
-- Found XCB_XINERAMA: /usr/lib/x86_64-linux-gnu/libxcb-xinerama.so (found version "1.15")
-- Could NOT find XCB_XINPUT (missing: XCB_XINPUT_LIBRARY XCB_XINPUT_INCLUDE_DIR) (found version "")
-- Found XCB_XKB: /usr/lib/x86_64-linux-gnu/libxcb-xkb.so (found version "1.15")
-- Could NOT find XCB_XPRINT (missing: XCB_XPRINT_LIBRARY XCB_XPRINT_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_XTEST (missing: XCB_XTEST_LIBRARY XCB_XTEST_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_XV (missing: XCB_XV_LIBRARY XCB_XV_INCLUDE_DIR) (found version "")
-- Could NOT find XCB_XVMC (missing: XCB_XVMC_LIBRARY XCB_XVMC_INCLUDE_DIR XCB_XV_FOUND) (found version "")


sudo apt install -y \
  libxcb-xkb-dev \
  libxcb-cursor-dev \
  libxcb-util-dev \
  libxcb-render-util0-dev \
  libxcb-ewmh-dev \
  libxcb-icccm4-dev \
  libxcb-image0-dev \
  libxcb-keysyms1-dev \
  libxcb-randr0-dev \
  libxcb-xinerama0-dev \
  libxcb-shape0-dev \
  libxcb-xfixes0-dev \
  libxcb-sync-dev \
  libxkbcommon-x11-dev


sudo apt install -y \
  libx11-dev \
  libx11-xcb-dev \
  libxext-dev \
  libxrender-dev \
  libxfixes-dev \
  libxrandr-dev \
  libxi-dev \
  libxcomposite-dev \
  libxcursor-dev \
  libxdamage-dev \
  libxtst-dev \
  libxss-dev \
  libxv-dev



sudo apt install -y \
  libgl1-mesa-dev \
  libglu1-mesa-dev \
  libegl1-mesa-dev \
  libgbm-dev

sudo apt install -y \
  libwayland-dev \
  libxkbcommon-dev \
  libxkbcommon-x11-dev

sudo apt install -y \
  libxcb-util0-dev \
  libxcb-dri3-dev \
  libxcb-present-dev \
  libxcb-glx0-dev

libfontconfig1-dev \
    libfreetype-dev \
    libgtk-3-dev \
    libx11-dev \
    libx11-xcb-dev \
    libxcb-cursor-dev \
    libxcb-glx0-dev \
    libxcb-icccm4-dev \
    libxcb-image0-dev \
    libxcb-keysyms1-dev \
    libxcb-randr0-dev \
    libxcb-render-util0-dev \
    libxcb-shape0-dev \
    libxcb-shm0-dev \
    libxcb-sync-dev \
    libxcb-util-dev \
    libxcb-xfixes0-dev \
    libxcb-xkb-dev \
    libxcb1-dev \
    libxext-dev \
    libxfixes-dev \
    libxi-dev \
    libxkbcommon-dev \
    libxkbcommon-x11-dev \
    libxrender-dev


libatspi2.0-dev


./CaptureStream2: /lib/x86_64-linux-gnu/libm.so.6: version `GLIBC_2.38' not found (required by ./CaptureStream2)
./CaptureStream2: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.38' not found (required by ./CaptureStream2)

libxcb-render
libSM
libpthread
xcb-present, xcb-glx, xcb-dri3, xcb-cursor, xkbcommon-x11

sudo apt install -y libxcb-render0-dev libsm-dev

qt-everywhere-src-6.5.3
-prefix
/opt/qt6
-static
-static-runtime
-developer-build
-skip
qtwebengine
-nomake
examples
-nomake
tests


Unable to find image 'qt6-static:local' locally
docker: Error response from daemon: pull access denied for qt6-static, repository does not exist or may require 'docker login': denied: requested access to the resource is denied.
See 'docker run --help'.




runs-on: ubuntu-latest
container:
  image: ubuntu:22.04

ldd ./CaptureStream2 | grep -E 'glib|gio|gobject'







FROM ubuntu:22.04

# 環境変数
ARG DEBIAN_FRONTEND=noninteractive
ARG QT_VERSION=6.9.0
ARG QT_VERSION1=6.9
ARG QT_MODULE=qtbase
ENV QT_VERSION=${QT_VERSION}
ENV QT_MODULE=${QT_MODULE}
ENV INSTALL_PREFIX=/opt/qt6-static

# 依存インストール
# Install dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    cmake \
    ninja-build \
    git \
    curl \
    ca-certificates \
    libx11-dev \
    libxext-dev \
    libxfixes-dev \
    libxi-dev \
    libxrender-dev \
    libxcb1-dev \
    libx11-xcb-dev \
    libxcb-glx0-dev \
    libxcb-keysyms1-dev \
    libxcb-image0-dev \
    libxcb-shm0-dev \
    libxcb-icccm4-dev \
    libxcb-sync-dev \
    libxcb-xfixes0-dev \
    libxcb-shape0-dev \
    libxcb-randr0-dev \
    libxcb-render-util0-dev \
    libxcb-util-dev \
    libxcb-cursor-dev \
    libxcb-xkb-dev \
    libxkbcommon-x11-dev \
    libxcb-util-dev \
    libxcb-icccm4-dev \
    libxcb-image0-dev \
    libxcb-keysyms1-dev \
    libxcb-render-util0-dev \
    libxkbcommon-dev \
    libfontconfig1-dev \
    libfreetype6-dev \
    libjpeg-dev \
    libpng-dev \
    zlib1g-dev \
    libgl1-mesa-dev \
    libglu1-mesa-dev \
    && rm -rf /var/lib/apt/lists/*

# Qt取得 & ビルド
# Download and extract Qt module source
WORKDIR /build
RUN curl -LO https://download.qt.io/official_releases/qt/${QT_VERSION%.*}/${QT_VERSION}/submodules/${QT_MODULE}-everywhere-src-${QT_VERSION}.tar.xz && \
    tar -xf ${QT_MODULE}-everywhere-src-${QT_VERSION}.tar.xz

# Configure, build, and install Qt statically
RUN mkdir qt-build && cd qt-build && \
    cmake -GNinja ../${QT_MODULE}-everywhere-src-${QT_VERSION} \
      -DCMAKE_INSTALL_PREFIX=${INSTALL_PREFIX} \
      -DCMAKE_BUILD_TYPE=Release \
      -DBUILD_SHARED_LIBS=OFF \
      -DQT_BUILD_EXAMPLES=OFF \
      -DQT_BUILD_TESTS=OFF \
      -DFEATURE_dbus=ON \
      -DFEATURE_icu=OFF \
      -DQT_FEATURE_opengl_desktop=ON \
      -DFEATURE_png=ON \
      -DFEATURE_jpeg=ON \
      -DFEATURE_freetype=ON \
      -DFEATURE_harfbuzz=ON \
      -DQT_FEATURE_gui=ON \
      -DQT_FEATURE_widgets=ON \
      -DQT_FEATURE_xlib=ON \
      -DQT_FEATURE_xcb=ON \
      -DQT_FEATURE_xcb_xlib=ON \
      -DQT_FEATURE_xkbcommon=ON \
      -DQT_FEATURE_fontconfig=ON \
      -DQT_FEATURE_sessionmanager=ON \
      -DQT_FEATURE_glib=OFF \
      -DQT_FEATURE_xrender=ON \
      -DFEATURE_system_zlib=OFF \
      -DFEATURE_system_png=OFF \
      -DFEATURE_system_jpeg=OFF \
      -DFEATURE_system_freetype=OFF \
      -DFEATURE_system_harfbuzz=OFF && \
    cmake --build . --parallel && \
    cmake --install . 

# PATH登録
ENV PATH="/opt/qt6-static/bin:$PATH"





# CMake 最新版をインストール
RUN apt-get update && \
    apt-get install -y wget && \
    wget https://github.com/Kitware/CMake/releases/download/v3.29.2/cmake-3.29.2-linux-x86_64.sh && \
    mkdir /opt/cmake && \
    sh cmake-3.29.2-linux-x86_64.sh --prefix=/opt/cmake --skip-license && \
    ln -s /opt/cmake/bin/cmake /usr/local/bin/cmake

# OpenSSLのソースコードをダウンロード
RUN wget https://www.openssl.org/source/openssl-3.3.0.tar.gz && \
    tar -xf openssl-3.3.0.tar.gz && \
    cd openssl-3.3.0 && \
    # `openssl-cmake`リポジトリをクローン
    git clone https://github.com/jimmy-park/openssl-cmake.git && \
    # `openssl-cmake` の CMakeLists.txt を `openssl-3.3.0` にコピー
    cp -r openssl-cmake/* . && \
    # OpenSSLのビルド
    mkdir build && \
    cd build && \
    cmake -DCMAKE_INSTALL_PREFIX=/usr \
          -DBUILD_SHARED_LIBS=OFF \
          -DOPENSSL_USE_STATIC_LIBS=ON \
          -DOPENSSL_BUILD_STATIC=ON \
          -DCMAKE_BUILD_TYPE=Release \
          -DOPENSSL_ROOT_DIR=../ \
          .. && \
    cmake --build . --parallel && \
    cmake --install .

